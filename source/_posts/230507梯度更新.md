---
title: 梯度更新
date: 2022-05-07 18:38:29
tags: [深度学习, math]
---

# 负梯度方向说明

民见传闻，当我们寻找凸函数最小值的时候，沿着负梯度方向去寻找是可以找到最小值的，为何？

假设有一个函数$y=f(x)$， 他存在着最小值$f(x_0)$， 假设我们移动一小步$\Delta x$
$$
f(x+\Delta x) - f(x) = f'(x)\Delta x
$$
很明显，当$\Delta x = -f'(x)$的时候，$f(x+\Delta x) - f(x)=- f'(x)^2 < 0$，当取负梯度方向的时候，可以保证下一步的取值肯定小于这一次的。



# 迭代可视化示例

给定一个函数
$$
f(x_1, x_2) = 3x_1^2+2x_1x_2+12x_2^2
$$
$x$轴有两个方向，需要对两个方向分别求偏导数
$$
\frac{\partial f}{\partial x_1}=6x_1+2x_2 \\
\frac{\partial f}{\partial x_2}=12x_2+2x_1 \\
$$
给定一个初始值$x_0=(x_{10}, x_{20})$, 后续按照负梯度方向更新
$$
x_{10} = x_{10}- \eta\frac{\partial f}{\partial x_1}\bigg|_{x=x_{10}} \\
x_{20} = x_{20}- \eta\frac{\partial f}{\partial x_2}\bigg|_{x=x_{20}} \\
$$
这里, $\eta$为步长

```python
# 导入相关库
import math
import random
import numpy as np
import matplotlib as mpl
import matplotlib.pyplot as plt
from tqdm.notebook import tqdm
from mpl_toolkits.mplot3d import Axes3D

# 定义一个二元函数
def func_1(x1, x2):
	return 3*x1*x1 + 2*x1*x2 + 6*x2*x2



# 对照原函数求偏导数
def hx1(x1, x2):
    return 6*x1 + 2*x2

def hx2(x1, x2):
    return 12*x2 + 2*x1


# 定义初始值、学习率以及迭代次数（可以换成随机数试试哦）
x1 = 5 # random.uniform(-5, 5)
x2 = 5 # random.uniform(-5, 5)
Lr = 0.05
Epochs = 100

# 保存梯度下降经过的点
GD_X1 = [x1]
GD_X2 = [x2]
GD_Y = [func_1(x1,x2)]


for epoch in tqdm(range(Epochs)):
    tmp_x1 = x1 - Lr * hx1(x1,x2)
    tmp_x2 = x2 - Lr * hx2(x1,x2)
    tmp_y = func_1(tmp_x1,tmp_x2)
    
    x1 = tmp_x1
    x2 = tmp_x2
    
    GD_X1.append(x1)
    GD_X2.append(x2)
    GD_Y.append(tmp_y)

print("最终结果为:(x1:%.5f, x2:%.5f, 最值：%.5f)" % (x1, x2, func_1(x1,x2)))


X1 = np.arange(-5, 5)
X2 = np.arange(-5, 5)
X1, X2 = np.meshgrid(X1, X2)
Y = np.array(list(map(lambda t : func_1(t[0],t[1]),zip(X1.flatten(),X2.flatten()))))
Y.shape = X1.shape
fig = plt.figure(facecolor='w', figsize=(20,18))
ax = Axes3D(fig)

ax.plot_surface(X1, X2, Y, rstride=1, cstride=1, cmap=plt.cm.jet, zorder=0)
ax.plot3D(GD_X1, GD_X2, GD_Y, 'ko-', zorder=10)

ax.set_xlabel('x')
ax.set_ylabel('y')
ax.set_zlabel('z')
ax.set_title('Func;\nLr:%.3f; Final result:(%.3f, %.3f, %.3f)' % (Lr, x1, x2, func_1(x1,x2)))
plt.show()

```

![](Screenshot from 2023-06-23 22-47-24.png)
