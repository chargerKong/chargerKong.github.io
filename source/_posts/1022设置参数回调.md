---
title: 参数回调 OnSetParametersCallbackHandle
date: 2021-10-22 10:59:22
tags: ros2
---

OnSetParametersCallbackHandle 在于foxy版本添加，dashing中还尚未支持。

在foxy版本中，也添加了返回此类型的回调函数，

```c++
  /// Add a callback for when parameters are being set.
  /**
   * The callback signature is designed to allow handling of any of the above
   * `set_parameter*` or `declare_parameter*` methods, and so it takes a const
   * reference to a vector of parameters to be set, and returns an instance of
   * rcl_interfaces::msg::SetParametersResult to indicate whether or not the
   * parameter should be set or not, and if not why.
   *
   * For an example callback:
   *
   * ```cpp
   * rcl_interfaces::msg::SetParametersResult
   * my_callback(const std::vector<rclcpp::Parameter> & parameters)
   * {
   *   rcl_interfaces::msg::SetParametersResult result;
   *   result.successful = true;
   *   for (const auto & parameter : parameters) {
   *     if (!some_condition) {
   *       result.successful = false;
   *       result.reason = "the reason it could not be allowed";
   *     }
   *   }
   *   return result;
   * }
   * ```
   *
   * You can see that the SetParametersResult is a boolean flag for success
   * and an optional reason that can be used in error reporting when it fails.
   *
   * This allows the node developer to control which parameters may be changed.
   *
   * Note that the callback is called when declare_parameter() and its variants
   * are called, and so you cannot assume the parameter has been set before
   * this callback, so when checking a new value against the existing one, you
   * must account for the case where the parameter is not yet set.
   *
   * Some constraints like read_only are enforced before the callback is called.
   *
   * The callback may introspect other already set parameters (by calling any
   * of the {get,list,describe}_parameter() methods), but may *not* modify
   * other parameters (by calling any of the {set,declare}_parameter() methods)
   * or modify the registered callback itself (by calling the
   * add_on_set_parameters_callback() method).  If a callback tries to do any
   * of the latter things,
   * rclcpp::exceptions::ParameterModifiedInCallbackException will be thrown.
   *
   * The callback functions must remain valid as long as the
   * returned smart pointer is valid.
   * The returned smart pointer can be promoted to a shared version.
   *
   * Resetting or letting the smart pointer go out of scope unregisters the callback.
   * `remove_on_set_parameters_callback` can also be used.
   *
   * The registered callbacks are called when a parameter is set.
   * When a callback returns a not successful result, the remaining callbacks aren't called.
   * The order of the callback is the reverse from the registration order.
   *
   * \param callback The callback to register.
   * \returns A shared pointer. The callback is valid as long as the smart pointer is alive.
   * \throws std::bad_alloc if the allocation of the OnSetParametersCallbackHandle fails.
   */
  RCLCPP_PUBLIC
  RCUTILS_WARN_UNUSED
  OnSetParametersCallbackHandle::SharedPtr
  add_on_set_parameters_callback(OnParametersSetCallbackType callback);
```

这是用于替代dashing版本中的set_on_parameters_set_callback

```c++
  /// Register a callback to be called anytime a parameter is about to be changed.
  /**
   * \deprecated Use add_on_set_parameters_callback instead.
   * With this method, only one callback can be set at a time. The callback that was previously
   * set by this method is returned or `nullptr` if no callback was previously set.
   *
   * The callbacks added with `add_on_set_parameters_callback` are stored in a different place.
   * `remove_on_set_parameters_callback` can't be used with the callbacks registered with this
   * method. For removing it, use `set_on_parameters_set_callback(nullptr)`.
   *
   * \param[in] callback The callback to be called when the value for a
   *   parameter is about to be set.
   * \return The previous callback that was registered, if there was one,
   *   otherwise nullptr.
   */
  [[deprecated("use add_on_set_parameters_callback(OnParametersSetCallbackType callback) instead")]]
  RCLCPP_PUBLIC
  OnParametersSetCallbackType
  set_on_parameters_set_callback(rclcpp::Node::OnParametersSetCallbackType callback);
```



